# Example configuration file for Salish Sea NEMO model nowcast system

# Python interpreter in environment with all dependencies installed
python: /home/dlatorne/anaconda/envs/nowcast/bin/python

# Filesystem group name to use for ownership of newly created files
file group: sallen

bathymetry: /data/dlatorne/MEOPAR/NEMO-forcing/grid/bathy_meter_SalishSea2.nc

rivers:
  # River name: wateroffice.ec.gc.ca station number
  Fraser: 08MF005

ssh:
  # Destination directory for Neah Bay sea surface height open boundary files
  ssh_dir: /ocean/nsoontie/MEOPAR/sshNeahBay/

weather:
  # Destination directory for downloaded GEM 2.5km operational model GRIB2 files
  GRIB_dir: /ocean/sallen/allen/research/MEOPAR/GRIB/
  # Destination directory for NEMO forcing files generated from GRIB2 files
  ops_dir: /ocean/sallen/allen/research/MEOPAR/Operational/
  # Location of wgrib2 executable
  wgrib2: /ocean/sallen/allen/research/MEOPAR/private-tools/grib2/wgrib2/wgrib2
  # Location of Pramod Thupaki's grid_defn.pl script
  grid_defn.pl: /ocean/sallen/allen/research/MEOPAR/private-tools/PThupaki/grid_defn.pl

upload forcing: /data/dlatorne/MEOPAR/tools/SalishSeaTools/salishsea_tools/nowcast/upload.sh

run:
  host: orcinus
  nodes: 5
  image name: nowcast-no-mntMEOPAR
  flavor name: m1.xlarge
  network label: NEMO-network
  ssh key name: doug-nefos
  floating ip pool: VLAN3337
  make forcing links: /home/dlatorne/MEOPAR/tools/SalishSeaTools/salishsea_tools/nowcast/makelinks.sh
  results: /home/dlatorne/MEOPAR/SalishSea/nowcast/
  results archive: /data/dlatorne/MEOPAR/SalishSea/nowcast/

logging:
  log_file: /home/dlatorne/public_html/MEOPAR/nowcast/nowcast.log
  backup_count: 7
  wgrib2_log_file: /home/dlatorne/public_html/MEOPAR/nowcast/wgrib2.log
  # Format strings must be quoted to protect % characters
  message_format: '%(asctime)s %(levelname)s [%(name)s] %(message)s'
  datetime_format: '%Y-%m-%d %H:%M:%S'

# Message system
ports:
  req_rep: 5555

msg_types:
  # message types registry
  nowcast_mgr:
    ack: message acknowledged
    undefined msg: ERROR - message type is not defined
  download_weather:
    success 06: 06 weather forecast ready
    failure 06: 06 weather forecast download failed
    success 18: 18 weather forecast ready
    failure 18: 18 weather forecast download failed
    crash: download_weather worker crashed
  make_runoff_file:
    success: rivers forcing ready
    failure: rivers forcing files preparation failed
    crash: make_runoff_file worker crashed
  get_NeahBay_ssh:
    success: Neah Bay ssh ready
    failure: Neah Bay sea surface height file preparation failed
    crash: get_NeahBay_ssh worker crashed
  grib_to_netcdf:
    success: atmospheric forcing ready
    failure: atmospheric forcing files preparation failed
    crash: grib_to_netcdf worker crashed
  init_cloud:
    success: cloud nodes initialization underway
    failure: cloud nodes initialization failed
    crash: init_cloud worker crashed
  create_compute_node:
    success: compute node created
    failure: compute node creation failed
    crash: create_compute_node worker crashed
  set_head_node_ip:
    success: head node IP address assigned
    success: head node IP address assignment failed
    success: set_head_node_ip worker crashed
  upload_forcing:
    success: forcing files uploaded
    failure: forcing files upload failed
    crash: upload_forcing worker crashed
  make_forcing_links:
    success: forcing file links created
    failure: forcing file links creation failed
    crash: make_forcing_links worker crashed
  download_results:
    success: results files downloaded
    failure: results files download failed
    crash: download_results worker crashed
    the end: end of automation
