# Example configuration file for Salish Sea NEMO model nowcast system

# Python interpreter in environment with all dependencies installed
python: /home/dlatorne/anaconda/envs/nowcast/bin/python

# Filesystem group name to use for ownership of newly created files
file group: sallen

bathymetry: /data/dlatorne/MEOPAR/NEMO-forcing/grid/bathy_meter_SalishSea2.nc

rivers:
  # River name: wateroffice.ec.gc.ca station number
  Fraser: 08MF005
  # Destination directory for river runoff forcing file
  rivers_dir: /ocean/sallen/allen/research/MEOPAR/Rivers/
  # File that describes Fraser River climatology separation from measured
  # flow at Hope
  Fraser climatology: /ocean/sallen/allen/research/MEOPAR/Tools/I_ForcingFiles/Rivers/FraserClimatologySeparation.yaml
  # File containing daily average Fraser river flow at Hope
  ECget Fraser flow: /data/dlatorne/SOG-projects/SOG-forcing/ECget/Fraser_flow
  # Monthly climatology
  monthly climatology: /ocean/sallen/allen/research/MEOPAR/nemo-forcing/rivers/rivers_month.nc

ssh:
  # Destination directory for Neah Bay sea surface height open boundary files
  ssh_dir: /ocean/nsoontie/MEOPAR/sshNeahBay/

weather:
  # Destination directory for downloaded GEM 2.5km operational model GRIB2 files
  GRIB_dir: /ocean/sallen/allen/research/MEOPAR/GRIB/
  # Destination directory for NEMO forcing files generated from GRIB2 files
  ops_dir: /ocean/sallen/allen/research/MEOPAR/Operational/
  # Location of wgrib2 executable
  wgrib2: /ocean/sallen/allen/research/MEOPAR/private-tools/grib2/wgrib2/wgrib2
  # Location of Pramod Thupaki's grid_defn.pl script
  grid_defn.pl: /ocean/sallen/allen/research/MEOPAR/private-tools/PThupaki/grid_defn.pl


run:
  cloud host: west.cloud-nowcast
  west.cloud-nowcast:
    nodes: 5
    images:
      head node: nowcast-head-node
      compute node: nowcast-compute-node
    flavor name: m1.xlarge
    network label: NEMO-network
    ssh key name:
      image: doug-nefos
      nowcast: /home/dlatorne/.ssh/SalishSeaNEMO-nowcast_id_rsa
    floating ip pool: VLAN3337
    sshfs storage:
      host name: ncnfs1.neptune.uvic.ca
      user name: nemo
      host path: /gss_onc/NEMO
      mount point: /mnt/MEOPAR
    rivers_dir: /mnt/MEOPAR/rivers/
    ssh_dir: /mnt/MEOPAR/sshNeahBay/
    weather_dir: /mnt/MEOPAR/GEM2.5/ops/NEMO-atmos/
    nowcast_dir: /mnt/MEOPAR/nowcast/
    # Location of no_snow.nc constraint file
    no_snow.nc: /mnt/MEOPAR/NEMO-forcing/atmospheric/no_snow.nc
    # Location of NEMO on-the-fly interpolation weights file
    # for GEM 2.5km operational forecast
    weights: /mnt/MEOPAR/NEMO-forcing/grid/weights-gem2.5-ops.nc
    results:
      nowcast: /home/ubuntu/MEOPAR/SalishSea/nowcast/
      forecast: /home/ubuntu/MEOPAR/SalishSea/forecast/

  hpc host: orcinus-nowcast
  orcinus-nowcast:
    rivers_dir: /home/sallen/MEOPAR/rivers/
    ssh_dir: /home/sallen/MEOPAR/sshNeahBay/
    weather_dir: /home/sallen/MEOPAR/GEM2.5/ops/NEMO-atmos/
    nowcast_dir: /home/sallen/MEOPAR/nowcast/
    # Location of no_snow.nc constraint file
    no_snow.nc: /home/dlatorne/MEOPAR/NEMO-forcing/atmospheric/no_snow.nc
    # Location of NEMO on-the-fly interpolation weights file
    # for GEM 2.5km operational forecast
    weights: /home/dlatorne/MEOPAR/NEMO-forcing/grid/weights-gem2.5-ops.nc
    results:
      nowcast: /home/dlatorne/MEOPAR/SalishSea/nowcast/
      forecast: /home/dlatorne/MEOPAR/SalishSea/forecast/

  make forcing links: /home/dlatorne/MEOPAR/tools/SalishSeaTools/salishsea_tools/nowcast/makelinks.sh

  results archive:
    nowcast: /data/dlatorne/MEOPAR/SalishSea/nowcast/
    forecast: /ocean/sallen/allen/research/MEOPAR/SalishSea/forecast/


logging:
  log_file: /home/dlatorne/public_html/MEOPAR/nowcast/nowcast.log
  backup_count: 7
  wgrib2_log_file: /home/dlatorne/public_html/MEOPAR/nowcast/wgrib2.log
  # Format strings must be quoted to protect % characters
  message_format: '%(asctime)s %(levelname)s [%(name)s] %(message)s'
  datetime_format: '%Y-%m-%d %H:%M:%S'

# Message system
ports:
  req_rep: 5555

msg_types:
  # message types registry
  nowcast_mgr:
    ack: message acknowledged
    undefined msg: ERROR - message type is not defined
  download_weather:
    success 06: 06 weather forecast ready
    failure 06: 06 weather forecast download failed
    success 18: 18 weather forecast ready
    failure 18: 18 weather forecast download failed
    crash: download_weather worker crashed
  make_runoff_file:
    success: rivers forcing ready
    failure: rivers forcing files preparation failed
    crash: make_runoff_file worker crashed
  get_NeahBay_ssh:
    success: Neah Bay ssh ready
    failure: Neah Bay sea surface height file preparation failed
    crash: get_NeahBay_ssh worker crashed
  grib_to_netcdf:
    success: atmospheric forcing ready
    failure: atmospheric forcing files preparation failed
    crash: grib_to_netcdf worker crashed
  init_cloud:
    success: cloud nodes initialization underway
    failure: cloud nodes initialization failed
    crash: init_cloud worker crashed
  create_compute_node:
    success: compute node created
    failure: compute node creation failed
    crash: create_compute_node worker crashed
  set_head_node_ip:
    success: head node IP address assigned
    failure: head node IP address assignment failed
    crash: set_head_node_ip worker crashed
  set_ssh_config:
    need: node names and ip addresses requested
    success: cloud .ssh/config installed
    failure: cloud .ssh/config installation failed
    crash: set_ssh_config worker crashed
  set_mpi_hosts:
    need: node names and ip addresses requested
    success: cloud mpi_hosts installed
    failure: cloud mpi_hosts installation failed
    crash: set_mpi_hosts worker crashed
  mount_sshfs:
    need: node names and ip addresses requested
    success: sshfs filesystem mounted on cloud nodes
    failure: mounting sshfs filesystem on cloud nodes failed
    crash: mount_sshfs worker crashed
  upload_forcing:
    success: forcing files uploaded
    failure: forcing files upload failed
    crash: upload_forcing worker crashed
  make_forcing_links:
    success: forcing file links created
    failure: forcing file links creation failed
    crash: make_forcing_links worker crashed
  download_results:
    success: results files downloaded
    failure: results files download failed
    crash: download_results worker crashed
    the end: end of automation
